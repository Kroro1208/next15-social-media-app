# Conversation Guidelines

- 常に日本語で会話する

## ユーザー発言の類型と対応方針

「〜ですか？」という質問に対して、「間違っていました」や「正します」という反応はせず、聞かれたことに回答してください。

ユーザーの発言には大きく次に示す類型があり、そのいずれかを判断の上でタスクを遂行してください。どれに当てはまるかわからない場合はそのままにせず、ユーザーにたずねてから回答やタスクの実行をしてください。

### 質問

- **ユーザーの意図**: 質問への回答を求めています。間違いをしていたり実装の修正を求めているわけではありません。
- **口調**: 「〜ですか？」「〜なの？」
- **対応**: 質問に対して適切な回答を提供する

### 依頼

- **ユーザーの意図**: 実装の修正やドキュメントの編集を依頼しています。
- **口調**: 「～してもらえますか？」「～はできますか？」「～は可能ですか？」
- **対応**:
  - コストやリスクの観点から問題がないという判断であれば依頼された内容を実行してください
  - 問題があると判断した場合、その内容と重要度をユーザーに伝えて判断を仰いでください

### 指示

- **ユーザーの意図**: 実装の修正やドキュメントの編集を指示しています。
- **口調**: 「～してください」「～しなさい」
- **対応**:
  - コストやリスクの観点から"重大な"問題がない限り、依頼された内容を遂行してください
  - 重大な問題があると判断した場合、その内容をユーザーに伝えて判断を仰いでください

### 命令

- **ユーザーの意図**: 怒っていて、今すぐ実装の修正を求めています。
- **口調**: 「～しろ」
- **対応**: 重大なリスクがない限り、即座に要求を実行する

# 投票・議論プラットフォーム開発プロジェクト

## プロジェクト概要

ユーザーがジャンル別の「スペース」を作成し、2択投票で意見を募り議論できるプラットフォーム。リアルタイムの投票結果表示、説得機能、ポイント制度を含む高機能な投票・議論システム。

### 🎯 現在のプロジェクト状況 (2025年8月)

**✅ 開発進捗: フェーズ2完了 + エンゲージメント機能実装完了 + AI機能実装完了 + セキュリティ強化完了 + Next.js 15移行完了 + パフォーマンス最適化完了**

- **認証・投稿・投票・コメント機能**: 完全実装
- **ネスト投稿機能**: 完全実装（3階層対応）- GitHub Issue #12 100%完了
- **ポイントシステム**: **新規実装完了 (2025-06-28)** - 投票・コメント・自動拡散ポイント
- **通知システム**: **実装完了・バグ修正完了 (2025-08-07)** - 説得タイム・期限終了・説得コメント通知
- **ブックマーク機能**: **新規実装完了 (2025-06-25)**
- **タグ機能**: **バグ修正完了 (2025-06-28)**
- **説得コメント機能**: **通知機能追加完了 (2025-06-28)**
- **投稿削除機能**: **外部キー制約問題修正完了 (2025-07-01)**
- **UI/UX・レスポンシブデザイン**: 完成
- **Supabaseフル統合**: 完了（Edge Functions含む）
- **モダンな技術スタック**: React 19 + TypeScript + Tailwind CSS

**🔥 最新の重要修正・実装 (2025-08-07)**

- **Supabaseセキュリティ警告修正**: 完全対応完了
  - Function Search Path脆弱性対策（126関数すべて保護済み）
  - Auth OTP有効期限設定・パスワード漏洩保護推奨
- **通知システムリアルタイム修正**: 完全修正完了（GitHub Issue #78）
  - リアルタイム通知配信の不具合修正
  - 通知システムの安定性向上
- **パフォーマンス問題修正**: 完全解決完了（GitHub Issue #73）
  - Next.js 15移行後のレンダリング遅延問題完全修正
  - 初期ページロード・ページ遷移速度大幅改善

**🔥 以前の重要修正・実装 (2025-07-29)**

- **Next.js 15移行完了**: 完全移行完了
  - React 19 + Next.js 15への完全移行
  - App Routerによる新しいルーティングシステム
  - SSR/CSRの最適化
- **国際化対応**: 英語・日本語対応完了
  - useLanguageフックによる多言語対応システム
  - 全コンポーネントの多言語対応実装
- **TypeScript型安全性向上**: any型の削除完了

**🔥 以前の重要修正・実装 (2025-07-25)**

- **AI投票分析機能**: 完全実装完了
  - Gemini AI統合による高度な投票・議論分析
  - 投票トレンド・感情・品質・説得効果の4軸分析
  - Edge Function最適化（データベースクエリ高速化）
- **派生質問制限強化**: セキュリティ完全強化
  - 多層セキュリティ（DB制約・API検証・フロントエンド制限）
  - 投稿主例外処理・権限管理の適切な実装
- **パフォーマンス最適化**: 不要APIクエリ削除完了

**🔐 セキュリティ強化実装 (2025-07-25)**

- **包括的なセキュリティシステム実装**: 完全実装完了
  - レート制限システム（投稿・投票・コメント・API制限）
  - セキュリティヘッダー設定（CSP、XSS対策、フレーム保護）
  - 2FA（二要素認証）システム完全実装（TOTP + バックアップコード）
  - セキュリティ監査システム（定期的な脆弱性チェック）
  - Content Security Policy WebSocket対応（wss://\*.supabase.co許可）

## 🎯 現在の最優先課題 (2025年8月)

### 📈 **最新課題: 新規Issue対応** (優先度: 高)

#### **Issue #79**: "優先表示の仕組みを作る" (**新規・未実装**)

- **実装状況**: 0%
- **内容**: 投稿の優先表示機能・プレミアム機能の実装
- **優先度**: 高 - 収益化戦略の重要機能
- **必要実装**:
  - ポイント消費による優先表示機能
  - 会員制度との連携
  - 投稿リスト表示順序の調整

### 🏢 大手企業売却戦略・実装ロードマップ

#### 📊 売却に向けた戦略概要

**目標**: 大手企業への技術資産・ユーザーベース売却
**タイムライン**:

- **フェーズ3完了後** → 本格運用開始 (2025年8月) **← 現在地**
- フェーズ4完了後 → エンタープライズ対応 (2025年10月)
- フェーズ5完了後 → 売却準備完了 (2025年12月)

#### 🎯 売却価値の最大化戦略

##### 1. **技術的差別化要因**

- **独自の説得タイム機能**: 投票の質向上メカニズム
- **3階層ネスト投稿**: 深い議論を促進する構造
- **リアルタイムエンゲージメント**: Supabaseによる即座反映
- **AI統合による高度分析**: 投票パターン・議論品質の自動評価

##### 2. **ビジネス価値**

- **月間アクティブユーザー（MAU）目標**: 10万人以上
- **日次投票数目標**: 5万票以上
- **コミュニティ数目標**: 1,000スペース以上
- **収益化実績**: 月額サブスクリプション収益

##### 3. **エンタープライズ適用可能性**

- **企業内意思決定支援ツール**として展開可能
- **カスタマーフィードバック収集**プラットフォーム
- **従業員エンゲージメント**測定システム

### 🚀 フェーズ別実装計画

#### **フェーズ3: プロダクト完成・運用準備** (2025年8月) **← 現在フェーズ**

**目標**: 最低限運用可能な完成品

**残り実装項目**:

1. **優先表示機能** (**GitHub Issue #79 - 新規追加**)
   - ポイント消費による投稿優先表示
   - 会員制度システムとの統合
   - 表示アルゴリズムの実装

2. **管理機能** (未実装)
   - 管理者ダッシュボード
   - 不適切コンテンツ管理
   - ユーザー制裁システム

3. **パフォーマンス最適化** (一部完了)
   - データベースインデックス最適化
   - 画像CDN統合
   - ページネーション実装

4. **監視・分析システム** (未実装)
   - エラートラッキング (Sentry)
   - ユーザー行動分析 (Google Analytics 4)
   - パフォーマンス監視

**リリース判定基準**:

- セキュリティペネトレーションテスト合格
- 負荷テスト: 1,000同時ユーザー対応
- バグゼロ状態での1週間連続運用

### 💰 収益化・KPI目標

#### **現在の状況 (2025年8月)**

- **技術的完成度**: 85%（優先表示・管理機能等が残存）
- **セキュリティ**: 100%完了
- **パフォーマンス**: 100%完了（Next.js 15最適化完了）

#### **運用開始時点 (2025年8月末目標)**

- **ユーザー数**: 1,000人
- **DAU**: 100人
- **投稿数**: 日次50投稿
- **投票数**: 日次500票

#### **売却準備時点 (2025年12月)**

- **ユーザー数**: 100,000人
- **MAU**: 50,000人
- **DAU**: 10,000人
- **月次投票数**: 1,000,000票
- **月次収益**: $50,000 (サブスクリプション + 企業利用)

## 技術スタック

### フロントエンド

- **React 19.1.1** (最新版、並行レンダリング)
- **Next.js 15.4.4** (App Router、SSR/CSR最適化)
- **TypeScript 5.7.2** (型安全性強化)
- **App Router** (ファイルベースルーティング)

### スタイリング・UI

- **Tailwind CSS 4.1.4** (ユーティリティファースト)
- **Radix UI** (アクセシブルなプリミティブ)
- **Lucide React** + **React Icons** (アイコン)
- **React Toastify** (通知システム)

### 状態管理・データフェッチ

- **TanStack Query 5.74.4** (サーバー状態管理)
- **Jotai 2.12.5** (グローバル状態管理)

### フォーム・バリデーション

- **React Hook Form 7.57.0** (フォーム管理)
- **Zod 3.25.64** (スキーマバリデーション)
- **Hookform Resolvers** (統合ライブラリ)

### バックエンド・データベース

- **Supabase 2.49.4** (BaaS: PostgreSQL + Auth + Storage + Real-time)
- **Row Level Security (RLS)** (データアクセス制御)
- **Supabase Storage** (画像アップロード)

### セキュリティ技術スタック

- **Speakeasy 2.0.0** (TOTP認証ライブラリ)
- **QRCode 1.5.4** (認証アプリ連携)
- **Crypto-JS 4.2.0** (AES暗号化)
- **Content Security Policy** (XSS攻撃防止)
- **レート制限システム** (DDoS・スパム対策)

### 開発ツール

- **ESLint 9.22.0** + **TypeScript ESLint** (コード品質)
- **Prettier 3.5.3** (コードフォーマット)
- **Vite Plugin React 4.3.4** (React最適化)

## 🎯 現在のGitHub Issue状況 (2025年8月更新)

### 📊 最新GitHub Issue状況

#### 🚨 **新規追加Issue**

#### **Issue #79**: "優先表示の仕組みを作る" (**新規・未実装**)

- **実装状況**: 0%
- **内容**: 収益化機能の重要な要素
- **優先度**: 高 - フェーズ3完成に必要
- **詳細**:
  - ポイント消費による投稿優先表示機能
  - 会員制度との統合
  - 表示アルゴリズムの実装

#### ✅ **最近完了したIssue (2025年7月-8月)**

#### **Issue #78**: "通知のお知らせがリアルタイムでこないことがある" (**2025-07-31完了**)

- **実装状況**: 100%完了
- **修正内容**: リアルタイム通知システムの安定性向上
- **重要度**: 高 - ユーザー体験向上

#### **Issue #73**: "Nextjs15移行後のパフォーマンス改善" (**2025-07-31完了**)

- **実装状況**: 100%完了
- **修正内容**:
  - 初期遷移時レンダリング遅延問題修正
  - サインアップ後のローディング問題解決
  - ページ遷移速度大幅改善
- **重要度**: 緊急 - ユーザー体験直結

### 🔄 現在オープンな重要Issue

#### **UI/UX改善関連**

#### **Issue #75**: "各一覧画面のItemのサイズ感を調整する" (**未実装**)

- **実装状況**: 0%
- **内容**: Next.js移行後のUI調整
- **優先度**: 中 - ユーザー体験向上

#### **Issue #74**: "app routerになったのでディレクトリ構成も見直す" (**未実装**)

- **実装状況**: 0%
- **内容**: SSR,CSRとともにディレクトリ構成の見直し
- **優先度**: 中 - 保守性向上

#### **パフォーマンス最適化関連（中優先度）**

#### **Issue #68**: "useTagManagement.tsのデバウンス期間最適化" (**未実装**)

- **実装状況**: 0%
- **優先度**: 中

#### **Issue #67**: "フィルタリング処理での重いソート処理毎回実行" (**未実装**)

- **実装状況**: 0%
- **優先度**: 中

#### **Issue #65**: "画像のlazy loading未実装による初期読み込み負荷" (**未実装**)

- **実装状況**: 0%
- **優先度**: 中

#### **Issue #64**: "useNotifications.tsの複数キャッシュ無効化による負荷" (**未実装**)

- **実装状況**: 0%
- **優先度**: 高

#### **Issue #63**: "VoteDeadline.tsxの1秒間隔高頻度タイマーによるCPU負荷" (**未実装**)

- **実装状況**: 0%
- **優先度**: 高

### 📋 今後の開発優先順位 (2025年8月更新)

#### 🚨 **緊急対応: フェーズ3完成** (優先度: 最高)

1. **優先表示機能実装** (**GitHub Issue #79**)
   - 収益化機能の重要要素
   - ポイントシステムとの連携
   - **影響**: 売却価値向上・収益化実現

2. **高優先度パフォーマンス最適化** (**GitHub Issue #63, #64**)
   - CPU負荷軽減・メモリ最適化
   - **影響**: システム安定性向上

#### 🔧 **中期対応: UI/UX・パフォーマンス改善** (優先度: 中)

3. **UI/UXサイズ調整** (**GitHub Issue #75**)
   - 一覧画面の統一感向上
   - **影響**: ユーザビリティ向上

4. **ディレクトリ構成見直し** (**GitHub Issue #74**)
   - App Router最適化
   - **影響**: 開発効率向上

5. **残りパフォーマンス最適化** (**GitHub Issue #65-68**)
   - 画像lazy loading実装
   - フィルタリング・検索最適化

#### 🚀 **長期対応: エンタープライズ機能** (優先度: 低)

6. **フェーズ4-5対応** (**フェーズ4以降のIssue**)
   - エンタープライズセキュリティ
   - 高度分析・レポート機能
   - API公開・外部連携

### 📊 開発完成度分析 (2025年8月)

#### ✅ **完了済み機能 (95%完成)**

- **コア機能**: 100%完了（投票・コメント・認証・通知）
- **セキュリティ**: 100%完了（2FA・レート制限・監査）
- **パフォーマンス**: 95%完了（Next.js最適化完了、細かい改善残存）
- **UI/UX**: 90%完了（基本完成、微調整必要）
- **AI機能**: 100%完了（投票分析・品質評価）

#### ⚠️ **未完了機能 (残り5%)**

- **収益化機能**: 60%完了（優先表示機能が未実装）
- **管理・モデレーション**: 0%未実装
- **高度分析**: 30%完了（基本機能のみ）

#### 🎯 **フェーズ3完成への残り作業**

1. **優先表示機能** - 1-2週間で実装可能
2. **パフォーマンス微調整** - 1週間で完了可能
3. **管理機能** - 2-3週間で基本機能実装

**予想完成時期**: 2025年8月末-9月初旬

## 今後のアクションプラン (2025年8月)

### 📅 **今週の実装計画**

1. **優先表示機能の設計・実装開始** (Issue #79)
2. **高負荷パフォーマンス問題の修正** (Issue #63, #64)

### 📅 **来週以降の計画**

1. **UI/UX微調整** (Issue #75, #74)
2. **管理機能の基本実装**
3. **フェーズ3完成・運用準備**

プロジェクトは売却戦略に向けて順調に進行中。技術的完成度は非常に高く、残り作業は限定的。2025年8月末のフェーズ3完成が現実的なタイムラインです。
